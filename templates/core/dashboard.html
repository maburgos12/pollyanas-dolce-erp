{% extends "base.html" %}

{% block title %}Dashboard - Pollyanas Dolce ERP{% endblock %}
{% block page_title %}Dashboard Ejecutivo{% endblock %}

{% block content %}
<section class="card">
    <div class="card-header">ltimo Sync de Almac茅n</div>
    {% if latest_almacen_sync %}
    <div class="table-responsive">
        <table class="table table-striped">
            <tbody>
                <tr>
                    <th>Estatus</th>
                    <td>
                        {% if latest_almacen_sync.status == "OK" %}
                            <span class="badge bg-success">OK</span>
                        {% else %}
                            <span class="badge bg-danger">ERROR</span>
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <th>Fecha</th>
                    <td>{{ latest_almacen_sync.started_at|date:"Y-m-d H:i" }}</td>
                </tr>
                <tr>
                    <th>Origen</th>
                    <td>{{ latest_almacen_sync.get_source_display }}</td>
                </tr>
                <tr>
                    <th>Carpeta / Mes</th>
                    <td>
                        {{ latest_almacen_sync.folder_name|default:"-" }}
                        {% if latest_almacen_sync.target_month %} 路 {{ latest_almacen_sync.target_month }}{% endif %}
                        {% if latest_almacen_sync.fallback_used %} (fallback){% endif %}
                    </td>
                </tr>
                <tr>
                    <th>Resultado</th>
                    <td>
                        Existencias {{ latest_almacen_sync.existencias_updated }} 路
                        Movimientos {{ latest_almacen_sync.movimientos_created }} 路
                        Sin match {{ latest_almacen_sync.unmatched }}
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    {% else %}
    <p style="margin: 0; color: var(--texto-light);">A煤n no hay sincronizaciones registradas.</p>
    {% endif %}
    <div class="quick-actions">
        <a href="{% url 'inventario:importar_archivos' %}" class="btn btn-secondary">Ver historial de sync</a>
    </div>
</section>

<div class="kpi-grid">
    <article class="kpi-card">
        <div class="kpi-number">{{ insumos_count }}</div>
        <div class="kpi-label">Insumos Activos</div>
    </article>
    <article class="kpi-card">
        <div class="kpi-number is-success">{{ recetas_count }}</div>
        <div class="kpi-label">Recetas Activas</div>
    </article>
    <article class="kpi-card">
        <div class="kpi-number is-warning">{{ proveedores_count }}</div>
        <div class="kpi-label">Proveedores Vigentes</div>
    </article>
    <article class="kpi-card">
        <div class="kpi-number is-danger">{{ alertas_count }}</div>
        <div class="kpi-label">Alertas de Stock</div>
    </article>
    <article class="kpi-card">
        <div class="kpi-number is-danger">{{ criticos_count }}</div>
        <div class="kpi-label">Cr铆ticos (sin stock)</div>
    </article>
    <article class="kpi-card">
        <div class="kpi-number is-warning">{{ bajo_reorden_count }}</div>
        <div class="kpi-label">Bajo Reorden</div>
    </article>
</div>

<section class="card">
    <div class="card-header">Accesos Operativos</div>
    <div class="quick-actions">
        {% if can_view_maestros %}
            <a href="{% url 'maestros:insumo_list' %}" class="btn btn-secondary"> Cat谩logo de insumos</a>
            <a href="{% url 'maestros:proveedor_list' %}" class="btn btn-secondary"> Cat谩logo de proveedores</a>
        {% endif %}
        {% if can_view_compras %}
            <a href="{% url 'compras:solicitudes' %}" class="btn btn-primary"> Flujo de compras</a>
        {% endif %}
        {% if can_view_inventario %}
            <a href="{% url 'inventario:existencias' %}" class="btn btn-primary"> Control de inventario</a>
        {% endif %}
        {% if can_view_reportes %}
            <a href="{% url 'reportes:costo_receta' %}" class="btn btn-secondary"> Reportes ejecutivos</a>
        {% endif %}
        {% if can_view_recetas %}
            <a href="{% url 'recetas:recetas_list' %}" class="btn btn-secondary"> Recetas y costeo</a>
        {% endif %}
        {% if can_review_matching %}
            <a href="{% url 'recetas:matching_pendientes' %}" class="btn btn-secondary"> Revisar matching</a>
        {% endif %}
    </div>
</section>

<section class="card">
    <div class="card-header">Resumen Fase 1</div>
    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>M贸dulo</th>
                    <th>Estado</th>
                    <th>Alcance sprint</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Maestros</td>
                    <td><span class="badge bg-success">Activo</span></td>
                    <td>ABM b谩sico de insumos y proveedores</td>
                </tr>
                <tr>
                    <td>Recetas</td>
                    <td><span class="badge bg-success">Activo</span></td>
                    <td>Listado, detalle, matching y MRP inicial</td>
                </tr>
                <tr>
                    <td>Compras</td>
                    <td><span class="badge bg-warning">Dise帽o funcional</span></td>
                    <td>Solicitudes, 贸rdenes y recepciones estructuradas</td>
                </tr>
                <tr>
                    <td>Inventario</td>
                    <td><span class="badge bg-warning">Dise帽o funcional</span></td>
                    <td>Existencias, movimientos y ajustes listos para integrar l贸gica</td>
                </tr>
                <tr>
                    <td>Reportes</td>
                    <td><span class="badge bg-warning">Dise帽o funcional</span></td>
                    <td>Costo receta, consumo y faltantes para visi贸n ejecutiva</td>
                </tr>
            </tbody>
        </table>
    </div>
</section>
{% endblock %}
