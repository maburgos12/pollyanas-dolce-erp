{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}ERP - Pollyanas Dolce{% endblock %}</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Nunito:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    {% block extra_css %}{% endblock %}
</head>
<body>
    <div class="layout-wrapper">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo" aria-hidden="true">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3.5 10.5 12 5l8.5 5.5L12 16 3.5 10.5Z"/>
                        <path d="M3.5 14 12 19l8.5-5"/>
                    </svg>
                </div>
                <div class="sidebar-brand">Pollyana's Dolce</div>
                <div class="sidebar-tagline">ERP OPERATIVO</div>
            </div>

            <nav>
                <ul class="sidebar-nav">
                    <li>
                        <a href="{% url 'dashboard' %}" class="{% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">
                            <span class="nav-icon" aria-hidden="true">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="8" height="8" rx="1.5"/><rect x="13" y="3" width="8" height="5" rx="1.5"/><rect x="13" y="10" width="8" height="11" rx="1.5"/><rect x="3" y="13" width="8" height="8" rx="1.5"/></svg>
                            </span>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    {% if ui_access.can_view_maestros %}
                    <li>
                        <a href="{% url 'maestros:proveedor_list' %}" class="{% if '/maestros/' in request.path %}active{% endif %}">
                            <span class="nav-icon" aria-hidden="true">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M3 7.5A2.5 2.5 0 0 1 5.5 5h4L11 7h7.5A2.5 2.5 0 0 1 21 9.5v8A2.5 2.5 0 0 1 18.5 20h-13A2.5 2.5 0 0 1 3 17.5v-10Z"/></svg>
                            </span>
                            <span>Maestros</span>
                        </a>
                    </li>
                    {% endif %}
                    {% if ui_access.can_view_recetas %}
                    <li>
                        <a href="{% url 'recetas:recetas_list' %}" class="{% if '/recetas/' in request.path and '/recetas/plan-produccion/' not in request.path %}active{% endif %}">
                            <span class="nav-icon" aria-hidden="true">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M5.5 4h13A1.5 1.5 0 0 1 20 5.5v13a1.5 1.5 0 0 1-1.5 1.5h-13A1.5 1.5 0 0 1 4 18.5v-13A1.5 1.5 0 0 1 5.5 4Z"/><path d="M8 9h8M8 13h8M8 17h5"/></svg>
                            </span>
                            <span>Recetas</span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'recetas:plan_produccion' %}" class="{% if '/recetas/plan-produccion/' in request.path %}active{% endif %}">
                            <span class="nav-icon" aria-hidden="true">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="5" width="18" height="16" rx="2"/><path d="M16 3v4M8 3v4M3 11h18"/></svg>
                            </span>
                            <span>Plan Producción</span>
                        </a>
                    </li>
                    {% endif %}
                    {% if ui_access.can_view_compras %}
                    <li>
                        <a href="{% url 'compras:solicitudes' %}" class="{% if '/compras/' in request.path %}active{% endif %}">
                            <span class="nav-icon" aria-hidden="true">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="20" r="1.5"/><circle cx="18" cy="20" r="1.5"/><path d="M3 4h2l2.6 10.5a1 1 0 0 0 1 .8h9.8a1 1 0 0 0 1-.76L21 7H7.2"/></svg>
                            </span>
                            <span>Compras</span>
                        </a>
                    </li>
                    {% endif %}
                    {% if ui_access.can_view_crm %}
                    <li>
                        <a href="{% url 'crm:pedidos' %}" class="{% if '/crm/' in request.path %}active{% endif %}">
                            <span class="nav-icon" aria-hidden="true">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                            </span>
                            <span>CRM</span>
                        </a>
                    </li>
                    {% endif %}
                    {% if ui_access.can_view_logistica %}
                    <li>
                        <a href="{% url 'logistica:rutas' %}" class="{% if '/logistica/' in request.path %}active{% endif %}">
                            <span class="nav-icon" aria-hidden="true">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M3 7h11v8H3z"/><path d="M14 10h3l3 3v2h-6z"/><circle cx="7" cy="17.5" r="1.5"/><circle cx="18" cy="17.5" r="1.5"/></svg>
                            </span>
                            <span>Logística</span>
                        </a>
                    </li>
                    {% endif %}
                    {% if ui_access.can_view_rrhh %}
                    <li>
                        <a href="{% url 'rrhh:empleados' %}" class="{% if '/rrhh/' in request.path %}active{% endif %}">
                            <span class="nav-icon" aria-hidden="true">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><path d="M20 8h3M21.5 6.5v3"/></svg>
                            </span>
                            <span>RRHH</span>
                        </a>
                    </li>
                    {% endif %}
                    {% if ui_access.can_view_inventario %}
                    <li>
                        <a href="{% url 'inventario:existencias' %}" class="{% if '/inventario/' in request.path and '/inventario/importar/' not in request.path %}active{% endif %}">
                            <span class="nav-icon" aria-hidden="true">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3 8.5 4.7v8.6L12 21l-8.5-4.7V7.7L12 3Z"/><path d="m3.5 7.7 8.5 4.8 8.5-4.8M12 12.5V21"/></svg>
                            </span>
                            <span>Inventario</span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'inventario:importar_archivos' %}" class="{% if '/inventario/importar/' in request.path %}active{% endif %}">
                            <span class="nav-icon" aria-hidden="true">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M12 4v10"/><path d="m8 8 4-4 4 4"/><path d="M4 15.5A2.5 2.5 0 0 0 6.5 18h11A2.5 2.5 0 0 0 20 15.5"/></svg>
                            </span>
                            <span>Carga Almacén</span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'activos:dashboard' %}" class="{% if '/activos/' in request.path %}active{% endif %}">
                            <span class="nav-icon" aria-hidden="true">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><rect x="4" y="5" width="16" height="14" rx="2"/><path d="M4 10h16"/><path d="M8 14h3M13 14h3"/></svg>
                            </span>
                            <span>Activos</span>
                        </a>
                    </li>
                    {% endif %}
                    {% if ui_access.can_view_reportes %}
                    <li>
                        <a href="{% url 'reportes:costo_receta' %}" class="{% if '/reportes/' in request.path %}active{% endif %}">
                            <span class="nav-icon" aria-hidden="true">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19h16"/><rect x="6" y="11" width="3" height="6" rx="1"/><rect x="11" y="8" width="3" height="9" rx="1"/><rect x="16" y="5" width="3" height="12" rx="1"/></svg>
                            </span>
                            <span>Reportes</span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'control:discrepancias' %}" class="{% if '/control/' in request.path %}active{% endif %}">
                            <span class="nav-icon" aria-hidden="true">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M4 20h16"/><path d="M7 20V9"/><path d="M12 20V4"/><path d="M17 20v-7"/><path d="m6 11 5-5 6 3"/></svg>
                            </span>
                            <span>Control</span>
                        </a>
                    </li>
                    {% endif %}
                    {% if ui_access.can_capture_piso %}
                    <li>
                        <a href="{% url 'control:captura_movil' %}" class="{% if '/control/captura-movil/' in request.path %}active{% endif %}">
                            <span class="nav-icon" aria-hidden="true">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><rect x="7" y="2.5" width="10" height="19" rx="2.5"/><path d="M10 6.5h4"/><circle cx="12" cy="18" r="1"/></svg>
                            </span>
                            <span>Captura Piso</span>
                        </a>
                    </li>
                    {% endif %}
                    {% if ui_access.can_view_audit %}
                    <li>
                        <a href="{% url 'audit_log' %}" class="{% if '/auditoria/' in request.path %}active{% endif %}">
                            <span class="nav-icon" aria-hidden="true">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M7 4h10l2 2v14H5V6l2-2Z"/><path d="M9 9h6M9 13h6M9 17h4"/></svg>
                            </span>
                            <span>Bitácora</span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'integraciones:panel' %}" class="{% if '/integraciones/' in request.path %}active{% endif %}">
                            <span class="nav-icon" aria-hidden="true">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="6" width="7" height="12" rx="1.5"/><rect x="14" y="3" width="7" height="7" rx="1.5"/><rect x="14" y="14" width="7" height="7" rx="1.5"/><path d="M10 12h4"/></svg>
                            </span>
                            <span>Integraciones</span>
                        </a>
                    </li>
                    {% endif %}
                    <li>
                        <a href="{% url 'admin:index' %}">
                            <span class="nav-icon" aria-hidden="true">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3.5"/><path d="M19.4 15a1 1 0 0 0 .2 1.1l.1.1a1.2 1.2 0 0 1-1.7 1.7l-.1-.1a1 1 0 0 0-1.1-.2 1 1 0 0 0-.6.9V19a1.2 1.2 0 0 1-2.4 0v-.2a1 1 0 0 0-.7-1 1 1 0 0 0-1 .2l-.2.1a1.2 1.2 0 1 1-1.7-1.7l.1-.1a1 1 0 0 0 .2-1.1 1 1 0 0 0-.9-.6H5a1.2 1.2 0 0 1 0-2.4h.2a1 1 0 0 0 1-.7 1 1 0 0 0-.2-1l-.1-.2a1.2 1.2 0 1 1 1.7-1.7l.1.1a1 1 0 0 0 1.1.2 1 1 0 0 0 .6-.9V5a1.2 1.2 0 1 1 2.4 0v.2a1 1 0 0 0 .7 1 1 1 0 0 0 1-.2l.2-.1a1.2 1.2 0 0 1 1.7 1.7l-.1.1a1 1 0 0 0-.2 1.1 1 1 0 0 0 .9.6h.2a1.2 1.2 0 0 1 0 2.4h-.2a1 1 0 0 0-1 .7Z"/></svg>
                            </span>
                            <span>Administración</span>
                        </a>
                    </li>
                </ul>
            </nav>

            <div class="sidebar-footer">
                <div class="sidebar-user">{{ user.username }}</div>
                <a href="{% url 'logout' %}" class="logout-link">Cerrar sesión</a>
            </div>
        </aside>

        <main class="main-content">
            <header class="header">
                <h1 class="header-title">{% block page_title %}Dashboard{% endblock %}</h1>
                <div class="header-meta">
                    {% now "l, j \d\e F \d\e Y" %}
                </div>
            </header>

            <div class="container">
                {% if messages %}
                    {% for message in messages %}
                        <div class="alert alert-{{ message.tags }}">{{ message }}</div>
                    {% endfor %}
                {% endif %}
                {% block content %}{% endblock %}
            </div>
        </main>
    </div>
    {% block extra_js %}{% endblock %}
</body>
</html>
