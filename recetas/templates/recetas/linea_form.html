{% extends "base.html" %}
{% block title %}{% if linea %}Editar línea{% else %}Nueva línea{% endif %}{% endblock %}
{% block content %}
<div class="card">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h3 class="mb-0">{% if linea %}Editar línea{% else %}Nueva línea{% endif %}</h3>
      <div class="text-muted">Receta: {{ receta.nombre }}</div>
    </div>
    <a class="btn btn-outline-secondary" href="{% url 'recetas:receta_detail' receta.id %}">Volver a receta</a>
  </div>

  <form method="post">
    {% csrf_token %}
    <div class="kpi-grid">
      <div class="form-group">
        <label for="posicion">Posición</label>
        <input id="posicion" class="form-control" type="number" min="1" name="posicion" value="{{ linea.posicion|default:'' }}">
      </div>
      <div class="form-group">
        <label for="cantidad">Cantidad</label>
        <input id="cantidad" class="form-control" type="number" step="0.000001" min="0" name="cantidad" value="{{ linea.cantidad|default:'' }}">
      </div>
      <div class="form-group">
        <label for="costo_linea_excel">Costo línea excel</label>
        <input id="costo_linea_excel" class="form-control" type="number" step="0.000001" min="0" name="costo_linea_excel" value="{{ linea.costo_linea_excel|default:'' }}">
      </div>
    </div>

    <div class="kpi-grid">
      <div class="form-group">
        <label for="insumo_texto">Ingrediente (texto)</label>
        <input id="insumo_texto" class="form-control" type="text" name="insumo_texto" value="{{ linea.insumo_texto|default:'' }}" required>
      </div>
      <div class="form-group">
        <label for="etapa">Etapa / Sección</label>
        <input id="etapa" class="form-control" type="text" name="etapa" value="{{ linea.etapa|default:'' }}" placeholder="Ej. Dream Whip, Fresa fresca">
      </div>
      <div class="form-group">
        <label for="unidad_texto">Unidad (texto)</label>
        <input id="unidad_texto" class="form-control" type="text" name="unidad_texto" value="{{ linea.unidad_texto|default:'' }}">
      </div>
    </div>

    <div class="kpi-grid">
      <div class="form-group">
        <label for="tipo_linea">Tipo de línea</label>
        <select id="tipo_linea" class="form-select" name="tipo_linea">
          {% for value, label in linea_tipo_choices %}
          <option value="{{ value }}" {% if linea.tipo_linea == value or (not linea and value == "NORMAL") %}selected{% endif %}>{{ label }}</option>
          {% endfor %}
        </select>
      </div>
    </div>

    <div class="kpi-grid">
      <div class="form-group">
        <label for="insumo_id">Insumo ligado</label>
        <select id="insumo_id" class="form-select" name="insumo_id">
          <option value="">Sin ligar</option>
          {% for i in insumos %}
          <option value="{{ i.id }}" {% if linea.insumo_id == i.id %}selected{% endif %}>{{ i.nombre }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-group">
        <label for="unidad_id">Unidad normalizada</label>
        <select id="unidad_id" class="form-select" name="unidad_id">
          <option value="">Sin unidad</option>
          {% for u in unidades %}
          <option value="{{ u.id }}" {% if linea.unidad_id == u.id %}selected{% endif %}>{{ u.codigo }} - {{ u.nombre }}</option>
          {% endfor %}
        </select>
      </div>
    </div>

    <div class="recipe-actions">
      <button type="submit" class="btn btn-primary">Guardar</button>
      <a class="btn btn-secondary" href="{% url 'recetas:receta_detail' receta.id %}">Cancelar</a>
    </div>
  </form>
</div>
{% endblock %}
