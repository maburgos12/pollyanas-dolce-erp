{% extends "base.html" %}
{% block title %}Inventario - Movimientos{% endblock %}
{% block page_title %}Inventario · Movimientos{% endblock %}

{% block content %}
<nav class="module-tabs">
  <a class="module-tab" href="{% url 'inventario:existencias' %}">Existencias</a>
  <a class="module-tab active" href="{% url 'inventario:movimientos' %}">Movimientos</a>
  <a class="module-tab" href="{% url 'inventario:ajustes' %}">Ajustes</a>
</nav>

<section class="card">
  <div class="card-header">Nuevo Movimiento</div>
  <form method="post" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px;">
    {% csrf_token %}
    <input class="input-field" type="datetime-local" name="fecha" required>
    <select class="input-field" name="tipo" required>
      {% for value, label in tipo_choices %}<option value="{{ value }}">{{ label }}</option>{% endfor %}
    </select>
    <select class="input-field" name="insumo_id" required>
      <option value="">Insumo</option>
      {% for i in insumos %}<option value="{{ i.id }}">{{ i.nombre }}</option>{% endfor %}
    </select>
    <input class="input-field" type="number" min="0" step="0.001" name="cantidad" placeholder="Cantidad" required>
    <input class="input-field" name="referencia" placeholder="Referencia">
    <button class="btn btn-primary" type="submit">Registrar movimiento</button>
  </form>
</section>

<section class="card">
  <div class="card-header">Bitácora de Movimientos</div>
  <div class="table-responsive">
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Fecha</th>
          <th>Tipo</th>
          <th>Insumo</th>
          <th class="text-end">Cantidad</th>
          <th>Referencia</th>
        </tr>
      </thead>
      <tbody>
        {% for m in movimientos %}
        <tr>
          <td>{{ m.fecha|date:"Y-m-d H:i" }}</td>
          <td><span class="badge bg-primary">{{ m.get_tipo_display }}</span></td>
          <td>{{ m.insumo.nombre }}</td>
          <td class="text-end">{{ m.cantidad }}</td>
          <td>{{ m.referencia|default:"-" }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="5" class="text-muted">Sin movimientos registrados.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>
{% endblock %}
